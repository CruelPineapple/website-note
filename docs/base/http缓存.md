# HTTP缓存

大致分为强制缓存和对比缓存，是存在浏览器里的缓存。其他web缓存包括数据库缓存，服务器缓存（CDN和代理服务器缓存），Web应用层缓存。HTTP缓存是浏览器缓存中基于http协议实现的，是最常见的缓存。

在首次请求资源的时候，没有缓存文件，后续请求会根据请求头部的缓存策略和缓存的状态（是否过期等）使用缓存中的内容。

## 强制缓存

对于强制缓存，在无缓存时，返回的数据会带有包含缓存规则的响应头部（Expires/Cache-Control），在符合使用缓存的规则时使用缓存

Expires用于http1.0，而且它不是http1.0一开始就规定的，是后续扩展的规则。现在一般都是http1.1，这已经用的很少了。Expires值表示到期时间，即在这个时间之前再次请求，会使用上一次返回的内容（它已经被缓存了）

Cache-Control是http1.1规定的头部字段之一，常见的取值有private，public，no-cache，max-age，no-store。默认值为private

```
private: 客户端可以缓存
public： 客户端和代理服务器都能缓存
max-age： 缓存内容有效的秒数
no-cache：使用对比缓存验证缓存数据
no-store：所有内容都不会缓存，强制缓存和对比缓存都不会触发
```

例如：

```
Cache-Control: max-age=31536000
```

这样的字段，指定了有效秒数，因此默认为private。表示一年之内都使用缓存

## 对比缓存

需要进行比较判断是否使用缓存。浏览器首次请求数据的时候，服务器会将缓存标识和数据返回给客户端。后续每次请求，客户端将缓存标识发送给服务器，服务器根据缓存标识判断是否允许客户端使用缓存。允许使用缓存时返回304状态码，不允许则使用200并返回需要使用的内容。

允许使用缓存的时候，只返回响应头部。

### 对比缓存标识

#### Last-Modified / If-Modified-Since

服务器在响应请求的时候使用Last-Mosified告知浏览器资源的最后修改时间

浏览器再次请求的时候，使用上一次收到的Last-Modified值作为If-Modified-Sience值通知服务器。服务器使用收到的If-Modified-Sience值和资源最后修改时间作对比，如果资源修改时间更大，说明资源改动过，则使用200状态码响应资源内容；否则使用304状态码告知浏览器使用缓存

#### Etag / If-None-Match

此标识优先级高于上面的Modified。

服务器在响应请求的时候使用Etag字段告知浏览器资源在服务器的唯一标识（这个标识是服务器生成的）

浏览器在后续请求的时候使用If-None-Match字段发送先前收到的Etag值，服务器使用收到的值与被请求资源的唯一标识进行比对，如果不同说明资源被修改过，使用200状态码响应资源内容；如果相同说明资源未被修改过，响应304告知浏览器使用缓存