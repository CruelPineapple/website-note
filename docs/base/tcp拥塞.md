# TCP拥塞控制

在输入负载不断增加的过程中，如果没有进行拥塞控制，可能造成缓冲区被占满发生死锁。TCP的四种拥塞控制算法：慢启动，拥塞控制，快速重传，快速恢复

## 慢启动

发送方拥塞窗口cwnd为1，发送方只能发送一个报文段，接收到该报文段的ACK之后拥塞窗口翻倍变为2，这时候可以一次发送两个报文段，在接收到这两个报文段的ACK之后，拥塞窗口再次翻倍。

## 拥塞避免

拥塞窗口指数增长，直到达到设定的慢启动门限值，此时进入拥塞避免状态，拥塞窗口在接收到上次发送报文段的所有ACK之后只增加1。一旦出现丢失的报文段导致计时器超时，判断网络可能出现拥塞，就把拥塞窗口重新设置为1，进入慢启动状态，同时慢启动门限设定为出现拥塞时刻拥塞窗口大小的一半。（这时候应该会缓慢重传？）

慢启动和拥塞避免是1988年提出的TCP Tahoe版本

后续TCP Reno版本对TCP性能进行改进，增加了快速重传和快速恢复算法

## 快速重传

快速重传的意思就是，不要等到计时器超时才判断丢失从而进行重传，而是接收方一旦发现失序报文段就持续提示发送方。

发送方发送1号报文段，并在接收到1号报文段的ACK之前还可以发送2号报文段。如果发送3号报文段的时候发生了丢失，接收方就会在收到4号报文段之后继续发送2号报文段的ACK。在这段时间内，发送方还发送了5号和6号报文段，接收方都已经接收并缓存了，但这时候返回的仍然是2号报文段的ACK。发送方已经连续接收到三次重复的确认，于是立即重传2号报文段，最后接收方收到2号报文段，向发送方送出6号报文段的ACK。

## 快速恢复

重复确认意味着丢失个别报文段，因此不会进入慢启动状态，而是使用快速恢复算法：将慢启动门限值和拥塞窗口值调整为当前发送窗口的一半，并进入拥塞避免状态。实际效果就是发送窗口减半并开始线性增长。

也有快速恢复算法将调整的窗口值设置为一半多三个，因为重复的三个ACK意味着已经成功发送了接下来的三个报文段，这三个报文段已经离开网络了，所以可以多三个。